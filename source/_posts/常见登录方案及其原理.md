```yaml
title: 常见登录方案及其原理
date: 2023-11-02
categories: 前端技术
tags: [Web,http]
```

# 常见登录方案及其原理

## 一、Cookie + Session登录

HTTP是一种无状态协议，因此服务器无法判断本次请求和上一次请求是否来自同一个用户，进而也就无法判断用户的登录状态。

为了解决HTTP无状态的问题，在1994年的时候，Cookie诞生。它是服务器端发送给客户端的一段特殊信息，这些信息以文本的方式存放在客户端，客户端每次向服务器端发送请求时都会带上这些特殊信息。

有了Cookie后，服务器端就能够获取到客户端传递的信息了，如果需要对信息进行验证，还需要通过Session。

客户端请求服务端时，服务器端会为这次请求开辟一块内存空间，这个便是Session对象。

有了Cookie和Session后，就可以进行登录认证了。

**工作流程**：

1. 用户登录：用户在登录页面输入用户名和密码，服务器验证用户提供的凭据是否正确。如果验证通过，服务器会创建一个会话，并在服务器端存储会话信息，通常是在内存或数据库中。

2. 会话管理：服务器会为每个会话分配一个唯一的会话标识符（Session ID）。会话信息通常包括用户的身份信息、权限信息等。服务器将会话标识符通过Cookie方式发送给客户端。

3. 用户访问：客户端在后续请求中携带会话标识符，服务器接收到请求后，会根据会话标识符查找对应的会话信息，以验证用户身份和授权。

4. 注销：用户点击注销按钮或者会话过期时，客户端和服务器都会清除会话信息。

**优缺点**：

- 优点：
  
  1. 简单易用：无需额外的编码和配置。
  
  2. 可以在服务器端进行会话管理和控制。

- 缺点：
  
  1. 状态维护：服务器需要在内存或数据库中维护会话信息，增加了服务器的负担。
  
  2. 扩展性差：难以在分布式系统中扩展。
  
  3. CSRF攻击：容易受到跨站请求伪造（CSRF）攻击。

## 二、JWT登录

JWT（JSON Web Token）是一种开放标准，用于在网络上安全地传输信息，它是一种紧凑且自包含的方式，用于在各方之间传输信息作为JSON对象。JWT通常被用作身份验证凭证，以及在信息交换过程中传递声明。

**JWT结构**：

一个JWT由三部分组成，每部分之间使用`.`分隔：

1. Header（头部）：包含了关于生成和验证这个token的信息，比如令牌的类型（即JWT）和所使用的签名算法。

2. Payload（载荷）：包含了声明，是关于实体（通常是用户）和其他数据的信息。

3. Signature（签名）：使用Base64编码的Header和Payload以及一个密钥，通过指定的算法进行签名生成的，用于验证消息的完整性。

**工作流程**：

1. 生成JWT：当用户进行身份验证后，服务器会生成一个JWT，并将其发送给客户端。

2. 传输JWT：客户端在接收到JWT后，可以将其存储在本地，比如LocalStorage或SessionStorage中。在发送请求时，将token放到HTTP请求头`Authorization`中，关于`Authorization`的设置，前面要加上Bearer，后面带有空格。

3. 验证JWT：当客户端发送请求给服务器时，通常会在请求头部中携带JWT。服务器在接收到请求后，会验证JWT的签名和有效期，以确保JWT的完整性和有效性。

4. 使用JWT：服务器可以根据JWT中的声明来识别用户身份和权限，从而决定是否授权用户访问特定资源。

**优缺点**：

- 优点：
  
  1. 轻量级和跨平台性：JWT是一种轻量级的跨平台标准，可以在不同的系统之间传递信息。
  
  2. 无状态性：JWT包含了所有必要的信息，服务器不需要在后续的请求中再次查询数据库来验证用户身份，这使得API设计更简单，可伸缩性更好。
  
  3. 安全性：JWT可以使用签名来验证数据完整性，确保数据在传输过程中不被篡改。可防护CSRF攻击

- 缺点：
  
  1. 无法撤销：一旦JWT被签发，就无法撤销。即使在有效期内，如果需要使某个JWT失效，也无法立即生效。
  
  2. 信息暴露：JWT的信息是以Base64编码存储的，虽然可以使用签名保证数据完整性，但无法加密，因此敏感信息不应该存储在JWT中。
  
  3. 不适于存储大量信息：由于JWT是在每次请求中携带的，如果需要存储大量信息，会增加请求的大小，不适合用于存储大型数据。

## 三、SSO单点登录

SSO（Single Sign-On）单点登录是一种身份验证机制，允许用户使用一组凭据（例如用户名和密码）登录到多个相关但独立的应用程序或系统，而无需多次输入凭据。通过SSO，用户只需依次登录即可访问多个应用程序，提高了用户体验并简化了身份验证流程。

**工作流程**：

1. 认证流程：用户在第一次登录时重定向到认证服务器，输入其凭据（用户名和密码），认证服务器验证这些凭据。一旦验证成功，将生成一个令牌（通常是加密的），并将其存储在用户的会话中。

2. 令牌传递：用户访问其他应用程序时，这些应用程序会向认证服务器发送令牌请求。认证服务器验证令牌的有效性，并向应用程序提供用户身份信息。

3. 无需再次登录：由于用户以拿到令牌，访问其他应用时，经历步骤2的过程，使得用户无需再次输入凭据，而是直接访问其他应用程序。

**优缺点**：

- 优点：
  
  1. 用户体验改善：SSO允许用户只需一次登录即可访问多个相关系统，提高了用户的便利性和体验。
  
  2. 安全性：通过集中管理用户身份验证，可以提高安全性并减少密码泄漏的风险。
  
  3. 简化管理：管理员可以更轻松地管理用户的权限和访问控制，而不需要在多个系统中分别管理。

- 缺点：
  
  1. 单点故障：SSO系统成为单点故障的潜在风险，如果SSO系统出现故障，用户将无法登录到任何相关系统。
  
  2. 安全风险：如果SSO凭据被盗或者出现安全漏洞，可能导致用户在多个系统中的身份受到威胁。

## OAuth 第三方登录

OAuth（Open Authorization）是一种授权框架，允许用户授权第三方应用访问其受保护的资源，而无需将用户名和密码直接提供给第三方应用。OAuth的第三方登录是OAuth框架的一种应用，允许用户使用其在一个网站上的身份验证信息来登录到另一个网站或应用程序，而无需创建新的账户。

**工作流程**：

1. 用户点击第三方登录按钮：用户在目标网站或应用程序上点击第三方登录按钮。

2. 重定向到认证提供者：用户被重定向到第三方认证提供者（如Google、Facebook等）的登录页面，要求用户提供其凭据进行身份验证。

3. 用户授权：用户登录到认证提供者并被询问是否授权目标网站或应用程序访问其信息的权限。用户可以选择授权或拒绝权限。

4. 生成访问令牌：如果用户授予权限，认证提供者将生成一个访问令牌，并将其发送回目标网站或应用程序。

5. 访问资源：目标网站或应用程序可以使用该令牌来访问用户在认证提供者上存储的受保护资源，如个人资料、头像等。

**优缺点**：

- 优点：
  
  1. 用户体验提升：用户可以通过使用其在其他网站上的凭据快速登录到新的网站或应用程序，简化了注册和登录流程，提升了用户体验。
  
  2. 隐私控制：用户可以更好地控制其个人信息的共享，选择性地授权第三方应用访问特定的信息，增强了隐私保护。
  
  3. 跨平台互通：用户可以在不同的网站和应用程序之间共享其身份验证信息，实现跨平台的互通性。

- 缺点：
  
  1. 安全风险：如果第三方登录未正确实施，可能存在安全风险，如未经授权的访问用户数据，钓鱼攻击等。
  
  2. 依赖第三方服务：使用OAuth第三方登录意味着依赖外部认证提供者的可用性和安全性，一旦认证提供者出现故障，可能会影响用户登录体验。
  
  3. 


